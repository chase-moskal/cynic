
# ğŸ§ cynic

*simple async run-anywhere js testing framework*

- run in node, browser, puppeteer, or anywhere
- test suites are nested async functions
- es modules and commonjs are both supported
- all examples here are typescript, but of course you can go vanilla js

## get cynical and make a test suite

1. install cynic into your project

    ```sh
    npm install --save-dev cynic
    ```

2. define a test suite, like `cool.test.ts`

    ```ts
    import {Suite, assert, expect} from "cynic"

    export default <Suite>{
      "alpha system": {
        "can sum two numbers (boolean return)": async() => {
          const a = 1
          const b = 2
          return (a + b) === 3
        },
        "can sum three numbers (assert)": async() => {
          const a = 1
          const b = 2
          const c = 3
          return assert((a + b + c) === 6, `sum is wrong`)
        }
      },
      "bravo system": {
        "can multiply numbers (expect)": async() => {
          const a = 2
          const b = 3
          return (
            expect(a * b).equals(6) &&
            expect(a * b * a).equals(12)
          )
        }
      }
    }
    ```

    - cynic test suites are recursive
    - the async functions are tests
    - objects can be nested to organize more and more tests
    - tests can return another test, or whole suite

## execute in node, browser, puppeteer, or anywhere else

- ### **use the cynic command line tool**

    ```sh
    # run your tests in node
    cynic node cool.test.js

    # run your tests in browser
    cynic browser cool.test.js

    # run your tests in puppeteer (headless browser)
    cynic puppeteer cool.test.js
    ```

    optional arguments for *all* environments
    - `--label="test suite"` â€” the report title

    optional arguments for *browser* and *puppeteer* environments
    - `--open=false` â€” true to prompt open your default browser
    - `--port=8021` â€” run the server on a different port
    - `--origin="http://localhost:8021"` â€” connect to the server via an alternative url (mind the port number!)
    - `--cynic-path=node_modules/cynic` â€” use an alternative path to the cynic library's root

    if puppeteer isn't running properly, see puppeteer's [troubleshooting.md](https://github.com/puppeteer/puppeteer/blob/master/docs/troubleshooting.md)

- ### **or just execute your test suite manually**

    should work anywhere you can execute es modules or commonjs

    ```ts
    import {test} from "cynic"
    import suite from "./cool.test.js"
    ;(async() => {

      // run the test suite
      const {report, ...stats} = await test("example suite", suite)

      // emit the report text to console
      console.log(report)

      // handle results programmatically
      if (stats.failed === 0) console.log("done")
      else console.log("failed!")

      // returns stats about the test run results
      console.log(stats)

    })()
    ```

    see which stats are available in the `Stats` interface in [interfaces.ts](./source/interfaces.ts)

## so what do the console reports look like?

- **report: successful run**

    ```
    cynic self-testing suite (node)
    
      â–½ examples
        â–½ alpha system
          âœ“ can sum two numbers (boolean return)
          âœ“ can sum three numbers (assertion)
        â–½ bravo system
          âœ“ can multiply numbers (expectation)
    
    0 failed tests
    0 thrown errors
    3 passed tests
    3 total tests
    0.00 seconds
    ```

- **report: a test returns false**  
    a test which doesn't return true will simply display as failed

    ```
    cynic self-testing suite (node)
    
      â–½ examples
        â–½ alpha system
    
    â•â•â•â•â• âœ˜ can sum two numbers (boolean return)
    
          âœ“ can sum three numbers (assertion)
        â–½ bravo system
          âœ“ can multiply numbers (expectation)
    
    1 failed tests
    0 thrown errors
    2 passed tests
    3 total tests
    0.00 seconds
    ```

- **report: a test throws a string**  
    a thrown string will be displayed as the failure reason

    ```
    cynic self-testing suite (node)
    
      â–½ examples
        â–½ alpha system
    
    â•â•â•â•â• âœ˜ can sum two numbers (boolean return)
    â€•â€•â€•â€•â€•â€•â€• arithmetic failed for interesting reasons!
    
          âœ“ can sum three numbers (assertion)
        â–½ bravo system
          âœ“ can multiply numbers (expectation)
    
    1 failed tests
    1 thrown errors
    2 passed tests
    3 total tests
    0.00 seconds
    ```

- **report: a test fails an assertion**  
    you get the assert message, and a full stack trace

    ```
    cynic self-testing suite (node)
    
      â–½ examples
        â–½ alpha system
          âœ“ can sum two numbers (boolean return)
    
    â•â•â•â•â• âœ˜ can sum three numbers (assertion)
    â€•â€•â€•â€•â€•â€•â€• CynicBrokenAssertion: sum is wrong
              at assert (file:///work/cynic/dist/assert.js:7:15)
              at can sum three numbers (assertion) (file:///work/cynic/dist/internals/example.test.js:13:20)
              at execute (file:///work/cynic/dist/internals/execute.js:13:34)
              [...]
    
        â–½ bravo system
          âœ“ can multiply numbers (expectation)
    
    1 failed tests
    1 thrown errors
    2 passed tests
    3 total tests
    0.00 seconds
    ```

- **report: a test fails an expectation**  
    a message is generated for the failed expectation, and stack trace provided

    ```
    cynic self-testing suite (node)
    
      â–½ examples
        â–½ alpha system
          âœ“ can sum two numbers (boolean return)
          âœ“ can sum three numbers (assertion)
        â–½ bravo system
    
    â•â•â•â•â• âœ˜ can multiply numbers (expectation)
    â€•â€•â€•â€•â€•â€•â€• CynicBrokenExpectation: expect(7).equals(6): not equal, should be
              at composite (file:///work/cynic/dist/expect.js:46:19)
              at Object.equals (file:///work/cynic/dist/expect.js:25:125)
              at can multiply numbers (expectation) (file:///work/cynic/dist/internals/example.test.js:20:39)
              at execute (file:///work/cynic/dist/internals/execute.js:13:34)
              [...]
    
    1 failed tests
    1 thrown errors
    2 passed tests
    3 total tests
    0.00 seconds
    ```

## hot tips

- use object nesting to group and organize tests arbitrarily

    ```ts
    import {Suite} from "cynic"
    export default <Suite>{
      "nested tests": {
        "more nested": {
          "exceedingly nested": {
            "loltest": async() => true
          }
        }
      }
    }
    ```

- you can just throw strings as assertions

    ```ts
    import {Suite} from "cynic"
    export default <Suite>{
      "assertions and expectations": async() => {
        const mystring = "abc"

        // the "spartan assertion"
        if (!mystring.includes("b"))
          throw `expected mystring to include "b"`

        return true
      }
    }
    ```

- or you can use the handy `assert` function to do that, you get stack traces

    ```ts
    import {Suite, assert} from "cynic"
    export default <Suite>{
      "using 'assert'": async() => {
        const example = "abc"

        assert(example === "abc",
          `example must equal "abc"`)

        assert(example.includes("b"),
          `example should include "b"`)

        // remember to return the asserts, or return true afterwards
        return true
      }
    }
    ```

- or you can also use the experimental new `expect` api, you get auto-generated messages and stack traces

    ```ts
    import {Suite, expect} from "cynic"
    export default <Suite>{
      "using 'expect'": async() => {
        const example = "abc"
        return (
          expect(example).defined() &&
          expect(example).equals("abc")
        )
      }
    }
    ```

- a suite or test can return another suite or test â€” *easy setups!*

    ```ts
    export default <Suite>(async() => {
      const myFile = loadFile("myfile.json")
      return {
        "group of tests": {
          "my file exists": async() => {
            return !!myFile
          }
        }
      }
    })
    ```

## food for thought

- it would be nice if we could display all errors instead of only the first one..

- ğŸ¥ƒ chase moskal made this with open source love. please contribute!
